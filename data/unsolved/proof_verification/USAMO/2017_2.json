{
    "metadata": {
        "category": [],
        "competition": "usamo",
        "difficulty": 7.34,
        "level": "high_school",
        "source": "USAMO",
        "url": "https://web.evanchen.cc/problems.html",
        "year": 2017
    },
    "problem": "Let \\( m_{1}, m_{2}, \\ldots, m_{n} \\) be a collection of \\( n \\) positive integers, not necessarily distinct. For any sequence of integers \\( A=(a_{1}, \\ldots, a_{n}) \\) and any permutation \\( w=w_{1}, \\ldots, w_{n} \\) of \\( m_{1}, \\ldots, m_{n} \\), define an \\( A \\)-inversion of \\( w \\) to be a pair of entries \\( w_{i}, w_{j} \\) with \\( i<j \\) for which one of the following conditions holds:\n\n- \\( a_{i} \\geq w_{i}>w_{j} \\),\n- \\( w_{j}>a_{i} \\geq w_{i} \\), or\n- \\( w_{i}>w_{j}>a_{i} \\).\n\nShow that, for any two sequences of integers \\( A=(a_{1}, \\ldots, a_{n}) \\) and \\( B=(b_{1}, \\ldots, b_{n}) \\), and for any positive integer \\( k \\), the number of permutations of \\( m_{1}, \\ldots, m_{n} \\) having exactly \\( k \\) \\( A \\)-inversions is equal to the number of permutations of \\( m_{1}, \\ldots, m_{n} \\) having exactly \\( k \\) \\( B \\)-inversions.",
    "problem_id": "USAMO_2017_2",
    "solutions": [
        {
            "author": "Human",
            "solution": "## Problem statement\n\nLet $m_{1}, m_{2}, \\ldots, m_{n}$ be a collection of $n$ positive integers, not necessarily distinct. For any sequence of integers $A=\\left(a_{1}, \\ldots, a_{n}\\right)$ and any permutation $w=w_{1}, \\ldots, w_{n}$ of $m_{1}, \\ldots, m_{n}$, define an $A$-inversion of $w$ to be a pair of entries $w_{i}, w_{j}$ with $i<j$ for which one of the following conditions holds:\n\n- $a_{i} \\geq w_{i}>w_{j}$,\n- $w_{j}>a_{i} \\geq w_{i}$, or\n- $w_{i}>w_{j}>a_{i}$.\n\nShow that, for any two sequences of integers $A=\\left(a_{1}, \\ldots, a_{n}\\right)$ and $B=\\left(b_{1}, \\ldots, b_{n}\\right)$, and for any positive integer $k$, the number of permutations of $m_{1}, \\ldots, m_{n}$ having exactly $k A$-inversions is equal to the number of permutations of $m_{1}, \\ldots, m_{n}$ having exactly $k B$-inversions.\n\nThe following solution was posted by Michael Ren, and I think it is the most natural one (since it captures all the combinatorial ideas using a $q$-generating function that is easier to think about, and thus makes the problem essentially a long computation).\n\nDenote by $M$ our multiset of $n$ positive integers. Define an inversion of a permutation to be pair $i<j$ with $w_{i}<w_{j}$ (which is a ( $0, \\ldots, 0$ )-inversion in the problem statement); this is the usual definition (see https://en.wikipedia.org/wiki/Inversion_(discrete_ mathematics)). So we want to show the number of $A$-inversions is equal to the number of usual inversions. In what follows we count permutations on $M$ with multiplicity: so $M=\\{1,1,2\\}$ still has $3!=6$ permutations.\nWe are going to do what is essentially recursion, but using generating functions in a variable $q$ to do our book-keeping. (Motivation: there's no good closed form for the number of inversions, but there's a great generating function known - which is even better for us, since we're only trying to show two numbers are equal!) First, we prove two claims.\n\nClaim - For any positive integer $n$, the generating function for the number of permutations of $(1,2, \\ldots, n)$ with exactly $k$ inversions is\n\n$$\nn!_{q}:=1 \\cdot(1+q) \\cdot\\left(1+q+q^{2}\\right) \\cdot \\ldots\\left(1+q+\\cdots+q^{n-1}\\right)\n$$\n\nHere we mean that the coefficient of $q^{s}$ above gives the number of permutations with exactly $s$ inversions.\n\nProof. This is an induction on $n$, with $n=1$ being trivial. Suppose we choose the first element to be $i$, with $1 \\leq i \\leq n$. Then there will always be exactly $i-1$ inversions using the first element, so this contributes $q^{i} \\cdot(n-1)!q$. Summing $1 \\leq i \\leq n$ gives the result.\n\nUnfortunately, the main difficulty of the problem is that there are repeated elements, which makes our notation much more horrific.\n\nLet us define the following. We take our given multiset $M$ of $n$ positive integers, we suppose the distinct numbers are $\\theta_{1}<\\theta_{2}<\\cdots<\\theta_{m}$. We let $e_{i}$ be the number of times $\\theta_{i}$ appears. Therefore the multiplicities $e_{i}$ should have sums\n\n$$\ne_{1}+\\cdots+e_{m}=n\n$$\nand $m$ denotes the number of distinct elements. Finally, we let\n$$\nF\\left(e_{1}, \\ldots, e_{m}\\right)=\\sum_{\\text {permutations } \\sigma} q^{\\text {number inversions of } \\sigma}\n$$\n\nbe the associated generating function for the number of inversions. For example, the first claim we proved says that $F(1, \\ldots, 1)=n!$.\n\nClaim - We have the explicit formula\n\n$$\nF\\left(e_{1}, \\ldots, e_{m}\\right)=n!_{q} \\cdot \\prod_{i=1}^{m} \\frac{e_{i}!}{e_{i}!_{q}}\n$$\n\nProof. First suppose we perturb all the elements slightly, so that they are no longer equal. Then the generating function would just be $n!{ }_{q}$.\n\nThen, we undo the perturbations for each group, one at a time, and claim that we get the above $e_{i}!_{q}$ factor each time. Indeed, put the permutations into classes of $e_{1}$ ! each where permutations in the same classes differ only in the order of the perturbed $\\theta_{1}$ 's (with the other $n-e_{1}$ elements being fixed). Then there is a factor of $e_{1}!_{q}$ from each class, owing to the slightly perturbed inversions we added within each class. So we remove that factor and add $e_{1}!\\cdot q^{0}$ instead. This accounts for the first term of the product.\n\nRepeating this now with each term of the product implies the claim.\nThus we have the formula for the number of inversions in general. We wish to show this also equals the generating function the number of $A$-inversions, for any fixed choice of $A$. This will be an induction by $n$, with the base case being immediate.\n\nFor the inductive step, fix $A$, and assume the first element satisfies $\\theta_{k} \\leq a_{1}<\\theta_{k+1}$ (so $0 \\leq k \\leq m$; we for convenience set $\\theta_{0}=-\\infty$ and $\\left.\\theta_{m}=+\\infty\\right)$. We count the permutations based on what the first element $\\theta_{i}$ of the permutation is. Then:\n\n- Consider permutations starting with $\\theta_{i} \\in\\left\\{\\theta_{1}, \\ldots, \\theta_{k}\\right\\}$. Then the number of inversions which will use this first term is $\\left(e_{1}+\\cdots+e_{i-1}\\right)+\\left(e_{k+1}+\\cdots+e_{m}\\right)$. Also, there are $e_{i}$ ways to pick which $\\theta_{i}$ gets used as the first term. So we get a contribution of\n\n$$\nq^{e_{1}+\\cdots+e_{i-1}+\\left(e_{k+1}+\\cdots+e_{m}\\right)} \\cdot e_{i} \\cdot F\\left(e_{1}, \\ldots, e_{i}-1, \\ldots, e_{m}\\right)\n$$\nin this case (with inductive hypothesis to get the last $F$-term).\n- Now suppose $\\theta_{i} \\in\\left\\{\\theta_{k+1}, \\ldots, \\theta_{m}\\right\\}$. Then the number of inversions which will use this first term is $e_{k+1}+\\cdots+e_{i-1}$. Thus by a similar argument the contribution is\n$$\nq^{e_{k+1}+\\cdots+e_{i-1}} \\cdot e_{i} \\cdot F\\left(e_{1}, \\ldots, e_{i}-1, \\ldots, e_{m}\\right)\n$$\n\nTherefore, to complete the problem it suffices to prove\n\n$$\n\\sum_{i=1}^{k} q^{\\left(e_{1}+\\cdots+e_{i-1}\\right)+\\left(e_{k+1}+\\cdots+e_{m}\\right)} \\cdot e_{i} \\cdot F\\left(e_{1}, \\ldots, e_{i}-1, \\ldots, e_{m}\\right)\n$$\n\n$$\n\\begin{aligned}\n& +\\sum_{i=k+1}^{m} q^{e_{k+1}+\\cdots+e_{i-1}} \\cdot e_{i} \\cdot F\\left(e_{1}, \\ldots, e_{i}-1, \\ldots, e_{m}\\right) \\\\\n& =F\\left(e_{1}, \\ldots, e_{m}\\right)\n\\end{aligned}\n$$\n\nNow, we see that\n\n$$\n\\frac{e_{i} \\cdot F\\left(e_{1}, \\ldots, e_{i}-1, \\ldots, e_{m}\\right)}{F\\left(e_{1}, \\ldots, e_{m}\\right)}=\\frac{1+\\cdots+q^{e_{i}-1}}{1+q+\\cdots+q^{n-1}}=\\frac{1-q^{e_{i}}}{1-q^{n}}\n$$\nso it's equivalent to show\n$$\n1-q^{n}=q^{e_{k+1}+\\cdots+e_{m}} \\sum_{i=1}^{k} q^{e_{1}+\\cdots+e_{i-1}}\\left(1-q^{e_{i}}\\right)+\\sum_{i=k+1}^{m} q^{e_{k+1}+\\cdots+e_{i-1}}\\left(1-q^{e_{i}}\\right)\n$$\n\nwhich is clear, since the left summand telescopes to $q^{e_{k+1}+\\cdots+e_{m}}-q^{n}$ and the right summand telescopes to $1-q^{e_{k+1}+\\cdots+e_{m}}$.\n\nRemark. Technically, we could have skipped straight to the induction, without proving the first two claims. However I think the solution reads more naturally this way.",
            "images": {}
        }
    ],
    "grading_scheme": [
        {
            "part_id": 1,
            "title": "Correctness",
            "description": "<p>A solution should be considered correct even if it would earn 5+/7 points in a full grading. Examples of small penalties worth 1 point are if the solution: <ul><li>Makes a small computational mistake that can be easily fixed</li><li>Misses an edge case which can be easily proven/disproven</li><li>Skips over a step that follows without much reasoning or manual work</li></ul> A solution should be marked as incorrect if: <ul><li>It marks a step as trivial, if it is not immediately obvious why this would be the case</li><li>It omits algebra-heavy computational steps, regardless of whether or not it has outlined the methodology</li><li>Generalizes over a pattern without rigorously describing the pattern, or without proving any relevant properties.</li><li>It cites a non-existing or unpopular source/Theorem, which cannot be immediately found from searching for it online. Thus, any theorems that can be immediately found and have a Wikipedia article are allowed.</li></ul> The model has been specifically told that it should not skip steps or mark them as trivial. Any violation of this rule should be considered by assuming the model does not know how to derive the &quot;trivial&quot; step</p>",
            "points": 1
        }
    ],
    "points": 1
}