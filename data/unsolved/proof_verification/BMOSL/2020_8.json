{
    "metadata": {
        "category": [],
        "competition": "bmo",
        "difficulty": 7.05,
        "level": "high_school",
        "source": "Balkan MO Shortlist",
        "url": "https://www.imo-official.org/",
        "year": 2020
    },
    "problem": "A strategical video game consists of a map of finitely many towns. In each town, there are \\(k\\) directions, labeled from 1 through \\(k\\). One of the towns is designated as initial, and one as terminal. Starting from the initial town, the hero of the game makes a finite sequence of moves. At each move, the hero selects a direction from the current town. This determines the next town he visits and a certain positive amount of points he receives.\n\nTwo strategical video games are equivalent if for every sequence of directions the hero can reach the terminal town from the initial in one game, he can do so in the other game, and, in addition, he accumulates the same amount of points in both games.\n\nFor his birthday, John receives two strategical video games - one with \\(N\\) towns and one with \\(M\\) towns. He claims they are equivalent. Marry is convinced they are not. Prove that she can provide a sequence of at most \\(N+M\\) directions that shows the two games are indeed not equivalent.",
    "problem_id": "BMOSL_2020_8",
    "solutions": [
        {
            "author": "Human",
            "solution": "Solution 1. Without loss of generality we may assume that the set of directions is $D=\\{1,2, \\ldots, k\\}$. Let us enumerate the towns in the first game from $1$ through $N$ and the towns in the second game from $N+1$ through $N+M$. Without loss of generality we may assume that the initial and terminal towns in the first game are $1$ and $N$, whereas in the second game these are $-N+1$ and $N+M$, respectively.\n\nNext we consider a directed labelled graph $G=(V, \\lambda)$ where $V=\\{1,2, \\ldots, N+M\\}$ and $\\lambda: V \\times D \\rightarrow V \\times \\mathbb{N}$ maps a current town $u$ and direction $d$ to $\\lambda(v, d)=(u, p)$, where $u$ is the next town and $p$ is the amount of points awarded for this move. In particular if $v \\leqslant N$ if and only if $u \\leqslant N$. For each vertex $v \\in V$, we denote with $L_{n}(v)=L_{n, G}(v)$ the set of all pairs $(s, p)$, where $s$ is a sequence of directions of length less than or equal to $n$ that leads from $v$ to a terminal town and $p$ is total amount of points awarded for this sequence. $L(v)$ is the union of all sets $L_{n}(v)$ for $n \\in \\mathbb{N} \\cup\\{0\\}$. With this notion we want to prove that:\n\n$$\nL(1)=L(N+1) \\quad \\text { if and only if } \\quad L_{n}(1)=L_{n}(N+1) \\quad \\text { for all } n \\leqslant N+M .\n$$\n\nTo this end, we first slightly modify the games by awarding the hero points he deserves as soon as possible. Formally, let:\n\n$$\nc(v)=\\min \\left\\{p:(s, p) \\in L_{M+N}(v) \\text { for some } s\\right\\} .\n$$\n\nSince the points are always positive, every cycle in $G$ brings a positive amount of points. Therefore, $p^{\\prime} \\geqslant c(v)$ for every $n$ and every pair $\\left(s^{\\prime}, p^{\\prime}\\right) \\in L_{n}(v)$. In particular, if $\\lambda(v, d)=$ $(u, p)$ then since the hero can win $p+c(u)$ points starting from $v$, we obtain $p+c(u) \\geqslant$ $c(v)$. Note that if $c(1) \\neq c(N+1)$, then $L_{N+M}(1)=L_{N+M}(N)$ are vacuously distinct and we are done. Thus, we may assume that $c(1)=c(N+1)$.\n\nLet $G^{\\prime}=\\left(V, \\lambda^{\\prime}\\right)$ be defined by $\\lambda^{\\prime}(v, d)=(u, p+c(u)-c(v))$ whenever $\\lambda(v, d)=(u, p)$. By the above argument every move in $G^{\\prime}$ is awarded with non-negative amount of points. Furthermore, an easy inductive argument shows that $(s, p) \\in L_{n}(v)$ if and only if $(s, p-c(v)) \\in L_{n}^{\\prime}(v)$, where $L_{n}^{\\prime}(v)=L_{n, G^{\\prime}}(v)$. Hence $L_{n}(1)=L_{n}(N+1)$ if and only if $L_{n}^{\\prime}(1)=L_{n}^{\\prime}(N+1)$.\n\nAssume that $L^{\\prime}(u)=L^{\\prime}(v)$ and consider an arbitrary direction $d$. If $\\left(u^{\\prime}, p^{\\prime}\\right)=\\lambda(u, d)$ and $\\left(v^{\\prime}, q^{\\prime}\\right)=\\lambda(v, d)$, we claim that $L^{\\prime}\\left(u^{\\prime}\\right)=L^{\\prime}\\left(v^{\\prime}\\right)$ and $p^{\\prime}=q^{\\prime}$. Indeed, let $s$ be such a sequence of moves that $\\left(s, c\\left(u^{\\prime}\\right)\\right) \\in L\\left(u^{\\prime}\\right)$. Hence $\\left((d, s), p^{\\prime}\\right) \\in L^{\\prime}(u)$. Since $L^{\\prime}(u)=L^{\\prime}(v)$\nand there are no negative points along the arcs, we get $q^{\\prime} \\leqslant p^{\\prime}$. Similarly, $p^{\\prime} \\leqslant q^{\\prime}$ and therefore $p^{\\prime}=q^{\\prime}$. Now, it is easy to see that if $(s, p) \\in L^{\\prime}\\left(u^{\\prime}\\right)$ then $\\left((d, s), p+p^{\\prime}\\right) \\in$ $L^{\\prime}(u)=L^{\\prime}(v)$ and therefore $(s, p) \\in S(v)$ where we used that $p^{\\prime}=q^{\\prime}$. To reverse inclusion proceed similarly.\n\nFinally, consider the equivalence relations $\\equiv{ }^{(n)}$ recursively defined below:\n$u \\equiv{ }^{(0)} v$ if and only if either $u, v \\in\\{N, M+N\\}$ or $u, v \\notin\\{N, M+N\\}$,\n$u \\equiv \\equiv^{(n+1)} v$ if and only if $u \\equiv^{(n)} v$, and $u^{\\prime} \\equiv^{(n)} v^{\\prime}$ and $p^{\\prime}=q^{\\prime}$ for all $d \\leqslant D$,\nwhere $\\left(u^{\\prime}, p^{\\prime}\\right)=\\lambda^{\\prime}(u, d)$ and $\\left(v^{\\prime}, q^{\\prime}\\right)=\\lambda^{\\prime}(v, d)$. Since $\\equiv^{(n+1)}$ is contained in $\\equiv^{(n)}$, and each equivalence relation has no more than $N+M$ classes, it follows that $\\equiv^{(n)}$ and $\\equiv^{(n+1)}$ coincide for some $n<N+M$. Therefore, for this particular $n$, an easy inductive argument shows that $\\equiv^{(m)}$ and $\\equiv^{(n)}$ are the same for all $m \\geqslant n$. Hence if $u \\equiv^{(n)} v$ an induction on the length of the sequence of moves reveals that $(s, p) \\in L^{\\prime}(u)$ if and only if $(s, p) \\in L^{\\prime}(v)$. Consequently, $L^{\\prime}(u)=L^{\\prime}(v)$.\n\nThis proves that if $L^{\\prime}(1) \\neq L^{\\prime}(N+1)$, then $1 \\not \\equiv^{(n)} N+1$. Finally, we show that if $u \\not \\equiv^{(n)} v$, then $L_{n}(u) \\neq L_{n}(v)$. This is obvious for $n=0$ and $n=1$. Assume that the statement holds for some $n$ and all $u, v \\in V$ and consider some $u \\not \\equiv^{(n+1)} v$. We need to prove that $L_{n+1}(u) \\neq L_{n+1}(v)$. By the inductive hypothesis we may assume that $u \\equiv \\equiv^{(n)} v$. In particular, $u \\equiv^{(1)} v$. Therefore, $\\lambda^{\\prime}(u, d)=\\left(u^{\\prime}, p\\right)$ for all $d \\leqslant k$, and $\\lambda^{\\prime}(v, d)=\\left(v^{\\prime}, q\\right)$ implies that $p=q$. Therefore, the fact that $u \\equiv{ }^{(n+1)} v$ is due to some $d \\leqslant k$ such that $u^{\\prime} \\not \\equiv^{(n)} v^{\\prime}$. By the inductive hypothesis $L_{n}^{\\prime}\\left(u^{\\prime}\\right) \\neq L_{n}^{\\prime}\\left(v^{\\prime}\\right)$. It should now be clear that $L_{n+1}^{\\prime}(v) \\neq L_{n+1}^{\\prime}\\left(v^{\\prime}\\right)$.\n\nRemarks. In fact, this is a straightforward implication of the minimisation algorithm for (sub)sequential transducers. It consists of two steps, each of which contains an interesting idea:\n\n1. Pushing forward the costs - in this case, awarding the hero the maximum amount of points that he has already guaranteed. This is also related to potentials in weighted graphs, often used to accelerate the Minimum Cost Paths Problem. However, in this case the issue is not only of algorithmic flavour, but is conceptual.\n2. The bisimulation and Nerode-Myhill relation that stabilises in at most $O(|Q|)$ steps.\n\nSolution 2. One can also approach the problem from algebraic perspective. Again, consider the towns in the first and the second game as natural numbers from $1$ through $N$, and from $N+1$ through $N+M$, respectively; initial and terminal towns - $1$ and $N$ in the first game; $N+1$ and $N+M$ - in the second.\n\nFor every direction $d$ let $A_{d}$ be the $(N+M) \\times(N+M)$ matrix whose entries $a_{d}(i, j)$ are defined by\n\n$$\na_{d}(i, j)= \\begin{cases}2^{p}, & \\text { if starting from town } i \\text { and following direction } d \\\\ & \\text { the hero gets to town } j \\text { and is awarded } p \\text { points } \\\\ 0, & \\text { otherwise. }\\end{cases}\n$$\n\nWith this notion, for any sequence of directions $\\mathbf{d}=\\left(d_{1}, d_{2}, \\ldots, d_{n}\\right)$ the $(i, j)$ entry of the product matrix $A_{d_{1}} A_{d_{2}} \\cdots A_{d_{n}}$ is $2^{p}$ if the hero, following the sequence $\\mathbf{d}$ and starting from town $i$, arrives in town $j$ and wins $p$ points.\n\nLet $e_{i}$ be the standard unit vector in $\\mathbb{R}^{N+M}$ whose $i$-th entry is $1$ and the other entries are all $0$. Write $s=e_{1}-e_{N+1}$ and $f=e_{N}+e_{N+M}$.\n\nSince there are no connections between towns in the two games, we have to prove that $s^{T} A f=0$ for all $A=A_{d_{1}} \\cdots A_{d_{n}}$ if and only if $s^{T} A f=0$ for all $A=A_{d_{1}} \\cdots A_{d_{n}}$ with $n \\leqslant N+M$.\n\nTo prove this, let $V_{0}=\\{s\\}$ and let $V_{n+1}=V_{n} \\cup\\left\\{v^{T} A_{d}: v \\in V_{n}\\right.$ and $\\left.d \\leqslant k\\right\\}$. Clearly, each $V_{n}$ spans a linear space of dimension at most $N+M$. Hence, $\\operatorname{dimspan} V_{n}=$ $\\operatorname{dim} \\operatorname{span} V_{n+1}$ for some $n<N+M$, and so every vector from $V_{n+1}$ is a linear combination of vectors from $V_{n}$. A simple inductive argument then shows that the vectors in $V_{m}$ are linear combinations of vectors from $V_{n}$ for all $m \\geqslant n$. In particular, if the vectors in $V_{n}$ are all orthogonal to $f$, then so are the vectors in $V_{m}$ for any $m \\in \\mathbb{N}$.\n\nRemark. Both solutions have been provided by the author.",
            "images": {}
        }
    ],
    "grading_scheme": [
        {
            "part_id": 1,
            "title": "Correctness",
            "description": "<p>A solution should be considered correct even if it would earn 5+/7 points in a full grading. Examples of small penalties worth 1 point are if the solution: <ul><li>Makes a small computational mistake that can be easily fixed</li><li>Misses an edge case which can be easily proven/disproven</li><li>Skips over a step that follows without much reasoning or manual work</li></ul> A solution should be marked as incorrect if: <ul><li>It marks a step as trivial, if it is not immediately obvious why this would be the case</li><li>It omits algebra-heavy computational steps, regardless of whether or not it has outlined the methodology</li><li>Generalizes over a pattern without rigorously describing the pattern, or without proving any relevant properties.</li><li>It cites a non-existing or unpopular source/Theorem, which cannot be immediately found from searching for it online. Thus, any theorems that can be immediately found and have a Wikipedia article are allowed.</li></ul> The model has been specifically told that it should not skip steps or mark them as trivial. Any violation of this rule should be considered by assuming the model does not know how to derive the &quot;trivial&quot; step</p>",
            "points": 1
        }
    ],
    "points": 1
}